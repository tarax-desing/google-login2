<!-- <html><head><base href="https://example.com/music-sorter/">
<meta charset="UTF-8">
<title>BPM Music Sorter</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
  :root {
    --primary: #1DB954;
    --dark: #191414;
    --light: #FFFFFF;
    --gray: #282828;
  }

  body {
    font-family: 'Circular', Arial, sans-serif;
    background: var(--dark);
    color: var(--light);
    margin: 0;
    padding: 20px;
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
  }

  .top-bar {
    display: flex;
    justify-content: flex-end;
    padding: 10px 20px;
    margin-bottom: 20px;
  }

  .header {
    margin-top: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 40px;
    background: var(--gray);
    padding: 30px;
    border-radius: 8px;
  }

  .header-left {
    display: flex;
    align-items: center;
  }

  .logo {
    height: 50px;
    margin-right: 20px;
    fill: var(--primary);
  }

  .search-container {
    background: var(--gray);
    padding: 30px;
    border-radius: 8px;
    margin-bottom: 40px;
  }

  .header-right {
    display: flex;
    gap: 20px;
    align-items: center;
  }

  .login-btn {
    background: transparent;
    color: var(--light);
    border: 1px solid var(--primary);
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
  }

  .login-btn:hover {
    background: var(--primary);
    border-color: var(--primary);
  }

  .main-content {
    margin-top: 30px;
  }

  .login-modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--gray);
    padding: 30px;
    border-radius: 12px;
    z-index: 1000;
    width: 400px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  }

  .login-modal input {
    width: 100%;
    padding: 12px;
    margin: 15px 0;
    border: 1px solid var(--primary);
    border-radius: 8px;
    background: var(--light);
  }

  #loginForm {
    display: flex;
    flex-direction: column;
  }

  .filter-container {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
  }

  .filter-select {
    padding: 8px;
    border-radius: 4px;
    background: var(--gray);
    color: var(--light);
    border: 1px solid var(--primary);
  }

  .search-input {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 4px;
    background: var(--light);
    margin-bottom: 10px;
  }

  .folders-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 30px;
    margin-top: 40px;
  }

  .folder {
    position: relative;
    background: var(--gray);
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .folder:hover {
    transform: translateY(-5px);
  }

  .folder h3 {
    display: flex;
    align-items: center;
    gap: 10px;
    position: relative;
    font-size: 1.2em;
    margin: 0 0 20px 0;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }

  .delete-folder {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    color: #ff4444;
    padding: 5px;
    border-radius: 50%;
  }

  .delete-folder:hover {
    background: rgba(255,0,0,0.1);
  }

  .song-list {
    max-height: 300px;
    overflow-y: auto;
    padding-right: 10px;
  }

  .song-item {
    background: rgba(255,255,255,0.05);
    padding: 12px;
    margin: 8px 0;
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .song-item:hover {
    background: rgba(255,255,255,0.1);
    transform: translateX(5px);
  }

  .bpm-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--primary);
    border-radius: 50%;
    font-size: 16px;
    margin-right: 15px;
  }

  button {
    background: var(--primary);
    color: var(--light);
    border: none;
    padding: 12px 24px;
    border-radius: 20px;
    cursor: pointer;
    transition: background 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    letter-spacing: 0.5px;
  }

  button:hover {
    background: #1ed760;
  }

  .custom-folder-modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--gray);
    padding: 30px;
    border-radius: 12px;
    z-index: 1000;
    width: 400px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  }

  .modal-backdrop {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 999;
  }

  .move-song-modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--gray);
    padding: 30px;
    border-radius: 12px;
    z-index: 1000;
    width: 400px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  }

  .folder-list {
    max-height: 300px;
    overflow-y: auto;
    margin: 10px 0;
  }

  .folder-option {
    padding: 8px;
    margin: 4px 0;
    background: rgba(255,255,255,0.1);
    border-radius: 4px;
    cursor: pointer;
  }

  .folder-option:hover {
    background: rgba(255,255,255,0.2);
  }

  .modal-buttons {
    display: flex;
    gap: 10px;
    margin-top: 25px;
    justify-content: flex-end;
  }

  .btn-cancel {
    background: #666;
  }

  .btn-cancel:hover {
    background: #777;
  }

  .btn-delete {
    background: #ff4444;
  }

  .btn-delete:hover {
    background: #ff6666;
  }

  .song-count {
    margin-left: auto;
    opacity: 0.7;
    font-size: 0.9em;
  }
</style>
</head>
<body>
<div class="container">
  <div class="top-bar">
    <button id="loginBtn" class="login-btn" onclick="showLoginModal()">
      ⚙️ Login
    </button>
  </div>

  <div class="main-content">
    <div class="header">
      <div class="header-left">
        <svg class="logo" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="45" fill="none" stroke="currentColor" stroke-width="8"/>
          <path d="M35 35 L35 65 L70 50 Z" fill="currentColor"/>
        </svg>
        <h1>BPM Music Sorter</h1>
      </div>
      <div class="header-right">
        <button onclick="createCustomFolder()">
          <span class="material-icons">create_new_folder</span>
          Crear Nueva Carpeta
        </button>
      </div>
    </div>

    <div class="search-container">
      <div class="filter-container">
        <select id="searchType" class="filter-select">
          <option value="track">Nombre de canción</option>
          <option value="artist">Artista</option>
          <option value="genre">Género</option>
          <option value="year">Año</option>
        </select>
        <input type="text" class="search-input" placeholder="Buscar canciones..." id="searchInput">
      </div>
      <button onclick="searchSongs()">
        <span class="material-icons">search</span>
        Buscar
      </button>
    </div>

    <div class="folders-grid">
      <div class="folder">
        <h3>
          <div class="bpm-icon">85</div>
          85-105 BPM
          <span class="song-count">0 songs</span>
        </h3>
        <div class="song-list" id="folder-85-105"></div>
      </div>

      <div class="folder">
        <h3>
          <div class="bpm-icon">105</div>
          105-120 BPM
          <span class="song-count">0 songs</span>
        </h3>
        <div class="song-list" id="folder-105-120"></div>
      </div>

      <div class="folder">
        <h3>
          <div class="bpm-icon">120</div>
          120-135 BPM
          <span class="song-count">0 songs</span>
        </h3>
        <div class="song-list" id="folder-120-135"></div>
      </div>

      <div class="folder">
        <h3>
          <div class="bpm-icon">135</div>
          135-148 BPM
          <span class="song-count">0 songs</span>
        </h3>
        <div class="song-list" id="folder-135-148"></div>
      </div>

      <div class="folder">
        <h3>
          <div class="bpm-icon">148</div>
          148+ BPM
          <span class="song-count">0 songs</span>
        </h3>
        <div class="song-list" id="folder-148-plus"></div>
      </div>

      <div id="custom-folders"></div>
    </div>
  </div>
</div>

<div class="modal-backdrop" id="modalBackdrop"></div>
<div class="custom-folder-modal" id="customFolderModal">
  <h3>Crear Nueva Carpeta</h3>
  <input type="text" id="folderNameInput" placeholder="Nombre de la carpeta">
  <div class="modal-buttons">
    <button onclick="saveCustomFolder()">
      <span class="material-icons">save</span>
      Guardar
    </button>
    <button class="btn-cancel" onclick="closeModal()">
      <span class="material-icons">close</span>
      Cancelar
    </button>
  </div>
</div>

<div class="login-modal" id="loginModal">
  <h3>Login</h3>
  <form id="loginForm" onsubmit="handleLogin(event)">
    <input type="email" id="emailInput" placeholder="Email" required>
    <input type="password" id="passwordInput" placeholder="Password" required>
    <div class="modal-buttons">
      <button type="submit">
        <span class="material-icons">login</span>
        Login
      </button>
      <button type="button" class="btn-cancel" onclick="closeLoginModal()">
        <span class="material-icons">close</span>
        Cancelar
      </button>
    </div>
  </form>
</div>

<div class="move-song-modal" id="moveSongModal">
  <h3>Mover canción a carpeta</h3>
  <div class="folder-list" id="folderList"></div>
  <button onclick="closeMoveModal()">Cancelar</button>
</div>

<script>
const CLIENT_ID = 'your_actual_client_id';
const CLIENT_SECRET = 'your_actual_client_secret';

let accessToken = null;
let customFolders = [];
let currentTrackToMove = null;

function loadCustomFolders() {
    const saved = localStorage.getItem('customFolders');
    if (saved) {
        customFolders = JSON.parse(saved);
        customFolders.forEach(folder => createCustomFolderElement(folder));
    }
}

function saveCustomFoldersToStorage() {
    localStorage.setItem('customFolders', JSON.stringify(customFolders));
}

async function getSpotifyToken() {
    try {
        const response = await fetch('https://accounts.spotify.com/api/token', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'Authorization': 'Basic ' + btoa(CLIENT_ID + ':' + CLIENT_SECRET)
            },
            body: 'grant_type=client_credentials'
        });
        if (!response.ok) {
            throw new Error('Failed to get token');
        }
        const data = await response.json();
        accessToken = data.access_token;
        
        setTimeout(getSpotifyToken, (data.expires_in - 60) * 1000);
    } catch (error) {
        console.error('Error getting token:', error);
        alert('Error conectando con Spotify. Por favor intente nuevamente.');
    }
}

async function searchSongs() {
    try {
        const searchInput = document.getElementById('searchInput');
        if (!searchInput.value.trim()) {
            alert('Por favor ingrese un término de búsqueda');
            return;
        }

        const searchButton = document.querySelector('.search-container button');
        searchButton.disabled = true;
        searchButton.innerHTML = '<span class="material-icons">hourglass_empty</span> Buscando...';

        if (!accessToken) await getSpotifyToken();
        
        const searchTerm = encodeURIComponent(searchInput.value);
        const searchType = document.getElementById('searchType').value;
        let endpoint = '';
        
        switch(searchType) {
            case 'track':
                endpoint = `search?q=${searchTerm}&type=track&limit=50`;
                break;
            case 'artist':
                endpoint = `search?q=artist:${searchTerm}&type=track&limit=50`;
                break;
            case 'genre':
                endpoint = `search?q=genre:${searchTerm}&type=track&limit=50`;
                break;
            case 'year':
                endpoint = `search?q=year:${searchTerm}&type=track&limit=50`;
                break;
        }
        
        const response = await fetch(`https://api.spotify.com/v1/${endpoint}`, {
            headers: {
                'Authorization': `Bearer ${accessToken}`
            }
        });
        
        if (!response.ok) throw new Error('Search failed');
        const data = await response.json();
        
        if (!data.tracks || !data.tracks.items.length) {
            alert('No songs found');
            return;
        }
        
        clearFolders();
        
        for (const track of data.tracks.items) {
            try {
                const audioFeatures = await getTrackAudioFeatures(track.id);
                if (audioFeatures && audioFeatures.tempo) {
                    sortSongByBPM(track, audioFeatures.tempo);
                }

            } catch (error) {
                console.error('Error getting audio features:', error);
            }
        }
    } catch (error) {
        console.error('Search error:', error);
        alert('Error al buscar canciones. Por favor intente nuevamente.');
    } finally {
        const searchButton = document.querySelector('.search-container button');
        searchButton.disabled = false;
        searchButton.innerHTML = '<span class="material-icons">search</span> Buscar';
    }
}

function clearFolders() {
    const folders = document.querySelectorAll('.song-list');
    folders.forEach(folder => folder.innerHTML = '');
}

function showMoveModal(trackId) {
    currentTrackToMove = trackId;
    const modal = document.getElementById('moveSongModal');
    const backdrop = document.getElementById('modalBackdrop');
    const folderList = document.getElementById('folderList');
    
    folderList.innerHTML = '';
    customFolders.forEach(folder => {
        const div = document.createElement('div');
        div.className = 'folder-option';
        div.textContent = folder.name;
        div.onclick = () => moveTrackToFolder(folder.id);
        folderList.appendChild(div);
    });
    
    modal.style.display = 'block';
    backdrop.style.display = 'block';
}

function closeMoveModal() {
    document.getElementById('moveSongModal').style.display = 'none';
    document.getElementById('modalBackdrop').style.display = 'none';
    currentTrackToMove = null;
}

function moveTrackToFolder(folderId) {
    if (!currentTrackToMove) return;
    
    const folder = customFolders.find(f => f.id === folderId);
    if (!folder) return;
    
    if (!folder.songs.includes(currentTrackToMove)) {
        folder.songs.push(currentTrackToMove);
        
        const originalSong = document.querySelector(`[data-track-id="${currentTrackToMove}"]`);
        if (originalSong) {
            const clonedSong = originalSong.cloneNode(true);
            const targetFolder = document.getElementById(`custom-folder-${folderId}`);
            targetFolder.appendChild(clonedSong);
            
            const moveButton = clonedSong.querySelector('button');
            moveButton.onclick = () => showMoveModal(currentTrackToMove);
            
            saveCustomFoldersToStorage();
        }
        
        updateFolderCount(`custom-folder-${folderId}`);
    }
    
    closeMoveModal();
}

function createSongElement(track) {
    const div = document.createElement('div');
    div.className = 'song-item';
    div.setAttribute('data-track-id', track.id);
    div.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px;">
            <span>${track.name} - ${track.artists[0].name}</span>
            <button onclick="event.stopPropagation(); showMoveModal('${track.id}')" style="margin-left: 10px;">
                <span class="material-icons">drive_file_move</span>
                Mover
            </button>
        </div>
    `;
    return div;
}

async function getTrackAudioFeatures(trackId) {
    const response = await fetch(`https://api.spotify.com/v1/audio-features/${trackId}`, {
        headers: {
            'Authorization': `Bearer ${accessToken}`
        }
    });
    return await response.json();
}

function sortSongByBPM(track, bpm) {
    const songElement = createSongElement(track);
    
    if (bpm >= 85 && bpm < 105) {
        document.getElementById('folder-85-105').appendChild(songElement);
        updateFolderCount('folder-85-105');
    } else if (bpm >= 105 && bpm < 120) {
        document.getElementById('folder-105-120').appendChild(songElement);
        updateFolderCount('folder-105-120');
    } else if (bpm >= 120 && bpm < 135) {
        document.getElementById('folder-120-135').appendChild(songElement);
        updateFolderCount('folder-120-135');
    } else if (bpm >= 135 && bpm < 148) {
        document.getElementById('folder-135-148').appendChild(songElement);
        updateFolderCount('folder-135-148');
    } else if (bpm >= 148) {
        document.getElementById('folder-148-plus').appendChild(songElement);
        updateFolderCount('folder-148-plus');
    }
}

function createCustomFolder() {
    document.getElementById('modalBackdrop').style.display = 'block';
    document.getElementById('customFolderModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('modalBackdrop').style.display = 'none';
    document.getElementById('customFolderModal').style.display = 'none';
    document.getElementById('moveSongModal').style.display = 'none';
    document.getElementById('folderNameInput').value = '';
}

function saveCustomFolder() {
    const folderName = document.getElementById('folderNameInput').value;
    if (folderName.trim()) {
        const folder = {
            id: Date.now(),
            name: folderName,
            songs: []
        };
        customFolders.push(folder);
        createCustomFolderElement(folder);
        saveCustomFoldersToStorage();
        closeModal();
        document.getElementById('folderNameInput').value = '';
    }
}

function createCustomFolderElement(folder) {
    const div = document.createElement('div');
    div.className = 'folder';
    div.id = `folder-container-${folder.id}`;
    div.innerHTML = `
        <h3>
            <span class="material-icons">folder</span> 
            ${folder.name}
            <button class="delete-folder" onclick="deleteFolder(${folder.id})">
                <span class="material-icons">delete</span>
            </button>
        </h3>
        <div class="song-list" id="custom-folder-${folder.id}"></div>
    `;
    document.getElementById('custom-folders').appendChild(div);
}

function deleteFolder(folderId) {
    if (confirm('¿Estás seguro de que quieres eliminar esta carpeta?')) {
        const folderElement = document.getElementById(`folder-container-${folderId}`);
        if (folderElement) {
            folderElement.remove();
        }
        
        customFolders = customFolders.filter(f => f.id !== folderId);
        saveCustomFoldersToStorage();
    }
}

let isLoggedIn = false;
let currentUser = null;

function showLoginModal() {
  document.getElementById('loginModal').style.display = 'block';
  document.getElementById('modalBackdrop').style.display = 'block';
}

function closeLoginModal() {
  document.getElementById('loginModal').style.display = 'none';
  document.getElementById('modalBackdrop').style.display = 'none';
  document.getElementById('loginForm').reset();
}

async function handleLogin(event) {
  event.preventDefault();
  
  const email = document.getElementById('emailInput').value;
  const password = document.getElementById('passwordInput').value;
  
  try {
    const user = {
      email: email,
      name: email.split('@')[0]
    };
    
    isLoggedIn = true;
    currentUser = user;
    
    const loginBtn = document.getElementById('loginBtn');
    loginBtn.innerHTML = `
      <span class="material-icons">account_circle</span>
      ${user.name}
    `;
    loginBtn.onclick = handleLogout;
    
    closeLoginModal();
    
    localStorage.setItem('user', JSON.stringify(user));
    
  } catch (error) {
    console.error('Login error:', error);
    alert('Error logging in. Please try again.');
  }
}

function handleLogout() {
  isLoggedIn = false;
  currentUser = null;
  
  const loginBtn = document.getElementById('loginBtn');
  loginBtn.innerHTML = `
    <span class="material-icons">account_circle</span>
    Login
  `;
  loginBtn.onclick = showLoginModal;
  
  localStorage.removeItem('user');
}

window.onload = async () => {
  await getSpotifyToken();
  loadCustomFolders();
  
  const savedUser = localStorage.getItem('user');
  if (savedUser) {
    currentUser = JSON.parse(savedUser);
    isLoggedIn = true;
    const loginBtn = document.getElementById('loginBtn');
    loginBtn.innerHTML = `
      <span class="material-icons">account_circle</span>
      ${currentUser.name}
    `;
    loginBtn.onclick = handleLogout;
  }
};

document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeModal();
    }
});

document.getElementById('modalBackdrop').addEventListener('click', closeModal);

document.getElementById('customFolderModal').addEventListener('click', function(e) {
    e.stopPropagation();
});

document.getElementById('moveSongModal').addEventListener('click', function(e) {
    e.stopPropagation();
});

window.onload = async () => {
    await getSpotifyToken();
    loadCustomFolders();
};
</script>
</body></html> -->